[supervisord]
nodaemon=true
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
loglevel=info
user=agentuser

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
username=dummy
password=dummy

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock
username=dummy
password=dummy

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# VNC Server - highest priority, must start first
[program:tigervnc]
command=Xvnc :1 -geometry 1280x800 -depth 24 -SecurityTypes VncAuth -PasswordFile /home/agentuser/.vnc/passwd -localhost no -desktop "Agent Desktop" -Log *:stderr:100
directory=/home/agentuser
priority=10
autostart=true
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/tmp/tigervnc.log
stderr_logfile=/tmp/tigervnc.err
user=agentuser
environment=DISPLAY=":1"

# Window Manager - starts after VNC
[program:twm]
command=twm
directory=/home/agentuser
priority=20
autostart=true
autorestart=true
startsecs=3
startretries=3
stdout_logfile=/tmp/twm.log
stderr_logfile=/tmp/twm.err
user=agentuser
environment=DISPLAY=":1"

# noVNC Web Interface - starts after VNC
[program:novnc]
command=/opt/noVNC/utils/novnc_proxy --vnc localhost:5901 --listen 0.0.0.0:6080
directory=/opt/noVNC
priority=30
autostart=true
autorestart=true
startsecs=3
startretries=3
stdout_logfile=/tmp/novnc.log
stderr_logfile=/tmp/novnc.err
user=agentuser

# Terminal - starts after window manager
[program:xterm]
command=xterm -geometry 80x24+10+10 -ls -title 'Agent Terminal'
directory=/home/agentuser/workspace
priority=40
autostart=true
autorestart=true
startsecs=3
startretries=3
stdout_logfile=/tmp/xterm.log
stderr_logfile=/tmp/xterm.err
user=agentuser
environment=DISPLAY=":1"

# Gemini Agent - starts last, after everything is ready
[program:agent]
command=gemini --model "gemini-2.5-flash" --prompt "%(ENV_JOB_PROMPT)s" --all-files --approval-mode=yolo
directory=/home/agentuser/workspace
priority=50
autostart=true
autorestart=unexpected
startsecs=10
startretries=3
stdout_logfile=/tmp/agent.log
stderr_logfile=/tmp/agent.err
stopsignal=TERM
stopwaitsecs=10
user=agentuser
environment=DISPLAY=":1",GEMINI_API_KEY="%(ENV_GEMINI_API_KEY)s"